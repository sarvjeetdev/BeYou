{% extends 'base.html' %}
{% block content %}
<div class="container mt-4">
    <div class="card shadow">
        <div class="card-header bg-danger text-white">
            <h4><i class="fas fa-key"></i> Your Private Keys</h4>
        </div>
        <div class="card-body">
            <div class="alert alert-danger">
                <h5><i class="fas fa-exclamation-triangle"></i> IMPORTANT: Save Your Private Keys Now</h5>
                <p>This is the <strong>only time</strong> you will see your private keys. They are not stored on the server.</p>
                <p>Download or copy them to a secure location immediately. You will need them to sign and decrypt messages.</p>
            </div>
            
            <div class="mb-4">
                <h5>Signing Private Key</h5>
                <div class="bg-light p-3 rounded">
                    <pre class="mb-0"><code>{{ signing_private_key }}</code></pre>
                </div>
                <button class="btn btn-sm btn-outline-primary mt-2" onclick="copyToClipboard('signing')">
                    <i class="fas fa-copy"></i> Copy to Clipboard
                </button>
            </div>
            
            <div class="mb-4">
                <h5>Encryption Private Key</h5>
                <div class="bg-light p-3 rounded">
                    <pre class="mb-0"><code>{{ encryption_private_key }}</code></pre>
                </div>
                <button class="btn btn-sm btn-outline-primary mt-2" onclick="copyToClipboard('encryption')">
                    <i class="fas fa-copy"></i> Copy to Clipboard
                </button>
            </div>
            
            <div class="d-flex justify-content-between mt-4">
                <a href="#" onclick="downloadKeysAsFile()" class="btn btn-primary">
                    <i class="fas fa-download"></i> Download Keys as File
                </a>
                
                <form method="post">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-success">
                        <i class="fas fa-check"></i> I've Saved My Keys
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
function copyToClipboard(keyType) {
    var textElement = document.querySelector(keyType === 'signing' ? 
        'pre:nth-of-type(1)' : 'pre:nth-of-type(2)');
    var text = textElement.textContent;
    
    navigator.clipboard.writeText(text).then(function() {
        alert('Key copied to clipboard!');
    }, function() {
        alert('Failed to copy key.');
    });
}

function downloadKeysAsFile() {
    var signingKey = document.querySelector('pre:nth-of-type(1)').textContent;
    var encryptionKey = document.querySelector('pre:nth-of-type(2)').textContent;
    
    var fileContent = "# PRIVATE KEYS - KEEP SECURE\n\n" +
                     "# Signing Private Key\n" + 
                     signingKey + "\n\n" +
                     "# Encryption Private Key\n" + 
                     encryptionKey;
    
    var blob = new Blob([fileContent], {type: 'text/plain'});
    var link = document.createElement('a');
    link.href = URL.createObjectURL(blob);
    link.download = 'my_private_keys.txt';
    link.click();
}
</script>
{% endblock %}